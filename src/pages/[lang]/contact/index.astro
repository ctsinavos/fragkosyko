---
import Layout from '../../../layouts/Layout.astro';
import Header from '../../../components/Header.astro';
import Footer from '../../../components/Footer.astro';
import { useTranslations, getLocalizedPath, languages, type Lang } from '../../../i18n/translations';

export function getStaticPaths() {
  return Object.keys(languages).map(lang => ({ params: { lang } }));
}

const { lang } = Astro.params as { lang: Lang };
const t = useTranslations(lang);
---

<Layout title={t('contact.meta.title')} description={t('contact.meta.description')}>
  <Header />

  <!-- Toast Notification -->
  <div id="toast" class="fixed bottom-4 right-4 z-50 transform translate-x-full opacity-0 transition-all duration-300 max-w-md">
    <div id="toast-content" class="rounded-2xl shadow-2xl p-6 flex items-start gap-4">
      <div id="toast-icon" class="flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center"></div>
      <div class="flex-1">
        <p id="toast-message" class="text-sm font-medium"></p>
      </div>
      <button id="toast-close" class="flex-shrink-0 text-charcoal/50 hover:text-charcoal transition-colors">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>
  </div>

  <section class="py-20 bg-gradient-to-br from-warm-sand/30 to-sea-teal/10">
    <div class="container mx-auto px-4 text-center">
      <h1 class="text-5xl md:text-6xl font-serif font-bold text-garden-green mb-6">{t('contact.hero.title')}</h1>
      <p class="text-lg max-w-3xl mx-auto text-charcoal/80">{t('contact.hero.subtitle')}</p>
    </div>
  </section>

  <section class="py-20 bg-cycladic-white">
    <div class="container mx-auto px-4">
      <div class="grid lg:grid-cols-2 gap-12 max-w-6xl mx-auto">
        <div>
          <h2 class="text-3xl font-serif font-bold mb-8 text-garden-green">{t('contact.info.visitTitle')}</h2>
          <div class="space-y-6 mb-8">
            <div class="flex items-start">
              <div class="w-12 h-12 bg-garden-green/10 rounded-full flex items-center justify-center mr-4 flex-shrink-0">
                <svg class="w-6 h-6 text-garden-green" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
              </div>
              <div>
                <h3 class="font-semibold text-lg mb-1">{t('contact.info.location')}</h3>
                <p class="text-charcoal/70">{t('contact.info.address.line1')}</p>
                <p class="text-charcoal/70">{t('contact.info.address.line2')}</p>
                <p class="text-charcoal/70">{t('contact.info.address.line3')}</p>
              </div>
            </div>
            <div class="flex items-start">
              <div class="w-12 h-12 bg-sea-teal/10 rounded-full flex items-center justify-center mr-4 flex-shrink-0">
                <svg class="w-6 h-6 text-sea-teal" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path></svg>
              </div>
              <div>
                <h3 class="font-semibold text-lg mb-1">{t('contact.info.phone')}</h3>
                <a href={`tel:${t('common.phone')}`} class="text-sea-teal hover:underline">{t('common.phone')}</a>
              </div>
            </div>
            <div class="flex items-start">
              <div class="w-12 h-12 bg-prickly-pear/10 rounded-full flex items-center justify-center mr-4 flex-shrink-0">
                <svg class="w-6 h-6 text-prickly-pear" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>
              </div>
              <div>
                <h3 class="font-semibold text-lg mb-1">{t('contact.info.email')}</h3>
                <a href={`mailto:${t('common.emailAddress')}`} class="text-prickly-pear hover:underline">{t('common.emailAddress')}</a>
              </div>
            </div>
            <div class="flex items-start">
              <div class="w-12 h-12 bg-garden-green/10 rounded-full flex items-center justify-center mr-4 flex-shrink-0">
                <svg class="w-6 h-6 text-garden-green" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
              </div>
              <div>
                <h3 class="font-semibold text-lg mb-1">{t('contact.info.openingHours')}</h3>
                <p class="text-charcoal/70">{t('contact.info.daily')}</p>
                <p class="text-sm text-charcoal/60 mt-2">{t('contact.info.brunchHours')}</p>
                <p class="text-sm text-charcoal/60">{t('contact.info.eveningHours')}</p>
              </div>
            </div>
          </div>
          <a href={getLocalizedPath('/reservations', lang)} class="inline-block w-full text-center px-8 py-4 bg-garden-green text-cycladic-white rounded-full hover:bg-garden-green-dark transition-all hover:shadow-lg font-semibold">{t('nav.bookTable')}</a>
        </div>
        <div>
          <h2 class="text-3xl font-serif font-bold mb-8 text-garden-green">{t('contact.info.findUs')}</h2>
          <div class="rounded-2xl overflow-hidden shadow-xl h-[500px]">
            <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3184.2101661730935!2d25.49456881167782!3d37.05247457206026!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x1498076098f6fbb9%3A0x169e2c799b8c9c41!2s44%20Miles%20Garden%20Coffee%20%26%20Food!5e0!3m2!1sen!2sgr!4v1763232625391!5m2!1sen!2sgr" width="100%" height="100%" style="border:0;" allowfullscreen="" loading="lazy"></iframe>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="py-20 bg-gradient-to-br from-warm-sand/20 to-sea-teal/10">
    <div class="container mx-auto px-4">
      <div class="max-w-2xl mx-auto">
        <h2 class="text-3xl font-serif font-bold text-center mb-4 text-garden-green">{t('contact.form.title')}</h2>
        <p class="text-center text-charcoal/70 mb-12">{t('contact.form.subtitle')}</p>
        <form id="contact-form" class="bg-white rounded-2xl shadow-xl p-8 md:p-12" name="contact" method="POST" data-netlify="true" netlify-honeypot="bot-field">
          <input type="hidden" name="form-name" value="contact" />
          <p class="hidden"><label>Don't fill this out: <input name="bot-field" /></label></p>
          <div class="grid md:grid-cols-2 gap-6 mb-6">
            <div>
              <label for="contact-name" class="block text-sm font-semibold text-charcoal mb-2">{t('contact.form.name')} *</label>
              <input type="text" id="contact-name" name="name" required class="w-full px-4 py-3 border border-warm-sand rounded-lg focus:ring-2 focus:ring-garden-green focus:border-transparent" placeholder={t('contact.form.name')} />
            </div>
            <div>
              <label for="contact-email" class="block text-sm font-semibold text-charcoal mb-2">{t('contact.form.email')} *</label>
              <input type="email" id="contact-email" name="email" required class="w-full px-4 py-3 border border-warm-sand rounded-lg focus:ring-2 focus:ring-garden-green focus:border-transparent" placeholder={t('common.emailAddress')} />
            </div>
          </div>
          <div class="mb-8">
            <label for="contact-message" class="block text-sm font-semibold text-charcoal mb-2">{t('contact.form.message')} *</label>
            <textarea id="contact-message" name="message" rows="6" required class="w-full px-4 py-3 border border-warm-sand rounded-lg focus:ring-2 focus:ring-garden-green focus:border-transparent" placeholder={t('contact.form.messagePlaceholder')}></textarea>
          </div>
          <button type="submit" class="w-full px-8 py-4 bg-garden-green text-cycladic-white rounded-full hover:bg-garden-green-dark transition-all hover:shadow-lg text-lg font-semibold">{t('contact.form.submit')}</button>
        </form>
      </div>
    </div>
  </section>

  <!-- Getting Here -->
  <section class="py-20 bg-white">
    <div class="container mx-auto px-4">
      <div class="max-w-4xl mx-auto">
        <h2 class="text-4xl font-serif font-bold text-center mb-4 text-garden-green">{t('contact.gettingHere.title')}</h2>
        <p class="text-center text-lg text-charcoal/70 mb-12">{t('contact.gettingHere.subtitle')}</p>
        <div class="grid md:grid-cols-3 gap-8">
          <div class="bg-gradient-to-br from-warm-sand/20 to-sea-teal/10 rounded-2xl p-8 text-center">
            <div class="w-16 h-16 bg-garden-green/10 rounded-full flex items-center justify-center mb-4 mx-auto">
              <span class="text-3xl">ðŸš¶</span>
            </div>
            <h3 class="text-xl font-serif font-bold mb-2 text-garden-green">{t('contact.gettingHere.byFoot.title')}</h3>
            <p class="text-charcoal/70">{t('contact.gettingHere.byFoot.description')}</p>
          </div>
          <div class="bg-gradient-to-br from-warm-sand/20 to-sea-teal/10 rounded-2xl p-8 text-center">
            <div class="w-16 h-16 bg-sea-teal/10 rounded-full flex items-center justify-center mb-4 mx-auto">
              <span class="text-3xl">ðŸšŒ</span>
            </div>
            <h3 class="text-xl font-serif font-bold mb-2 text-sea-teal">{t('contact.gettingHere.byBus.title')}</h3>
            <p class="text-charcoal/70">{t('contact.gettingHere.byBus.description')}</p>
          </div>
          <div class="bg-gradient-to-br from-warm-sand/20 to-sea-teal/10 rounded-2xl p-8 text-center">
            <div class="w-16 h-16 bg-prickly-pear/10 rounded-full flex items-center justify-center mb-4 mx-auto">
              <span class="text-3xl">ðŸš•</span>
            </div>
            <h3 class="text-xl font-serif font-bold mb-2 text-prickly-pear">{t('contact.gettingHere.byTaxi.title')}</h3>
            <p class="text-charcoal/70">{t('contact.gettingHere.byTaxi.description')}</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <Footer />
</Layout>

<script define:vars={{ successMessage: t('toast.contactSuccess'), errorMessage: t('toast.error') }}>
  const form = document.getElementById('contact-form');
  const toast = document.getElementById('toast');
  const toastContent = document.getElementById('toast-content');
  const toastIcon = document.getElementById('toast-icon');
  const toastMessage = document.getElementById('toast-message');
  const toastClose = document.getElementById('toast-close');

  function showToast(message, isSuccess = true) {
    if (isSuccess) {
      toastContent.className = 'rounded-2xl shadow-2xl p-6 flex items-start gap-4 bg-garden-green/10 border border-garden-green/30';
      toastIcon.className = 'flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center bg-garden-green';
      toastIcon.innerHTML = '<svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>';
    } else {
      toastContent.className = 'rounded-2xl shadow-2xl p-6 flex items-start gap-4 bg-red-50 border border-red-200';
      toastIcon.className = 'flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center bg-red-500';
      toastIcon.innerHTML = '<svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>';
    }
    toastMessage.textContent = message;
    toast.classList.remove('translate-x-full', 'opacity-0');

    setTimeout(() => {
      hideToast();
    }, 6000);
  }

  function hideToast() {
    toast.classList.add('translate-x-full', 'opacity-0');
  }

  toastClose.addEventListener('click', hideToast);

  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    const submitBtn = form.querySelector('button[type="submit"]');
    const originalText = submitBtn.textContent;
    submitBtn.disabled = true;
    submitBtn.textContent = '...';

    try {
      const formData = new FormData(form);
      const response = await fetch('/', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: new URLSearchParams(formData).toString()
      });

      if (response.ok) {
        showToast(successMessage, true);
        form.reset();
      } else {
        showToast(errorMessage, false);
      }
    } catch (error) {
      showToast(errorMessage, false);
    } finally {
      submitBtn.disabled = false;
      submitBtn.textContent = originalText;
    }
  });
</script>

